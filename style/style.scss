@use 'sass:list';
@use 'sass:math';

:root {
  --slider-z-from: 0;
  --slider-z-to: 0;
  --slider-x: 0;
  --slider-y: 0;
}

.color-picker {
  $canvas-width: 25rem;
  $canvas-height: 25rem;
  $slider-thickness: 2.5rem;
  $gap: 2.5rem;
  $p: 2.5rem;
  $border-thickness: 0.0625rem;
  $border-color: oklch(70% 0 0deg);
  $thumb-display-size: 1rem;
  $thumb-size: 3rem;
  $thumb-border-thickness: 0.125rem;
  $gradient-resolution: 60;

  display: grid;
  grid-template-rows: calc($canvas-height + 2 * $border-thickness) calc(
      $slider-thickness + 2 * $border-thickness
    );
  grid-template-columns: calc($slider-thickness + 2 * $border-thickness) calc(
      $canvas-width + 2 * $border-thickness
    );
  gap: $gap;
  width: fit-content;
  padding: $p;
  background-color: oklch(95% 0 0deg);
  border-radius: 1.5rem;

  @mixin canvas() {
    &__canvas {
      width: 100%;
      height: 100%;
    }
  }

  @mixin area() {
    position: relative;

    &__area {
      position: absolute;
      @content;
    }
  }

  @mixin thumb() {
    &__thumb {
      $selector: #{&};

      position: absolute;
      width: $thumb-size;
      height: $thumb-size;
      cursor: grab;

      @content;

      &::before {
        position: absolute;
        inset: calc(0.5 * ($thumb-size - $thumb-display-size));
        display: block;
        content: '';
        border: $thumb-border-thickness solid #fff;
        box-shadow: 0 0.0625rem 0.1875rem 0.0625rem rgb(0 0 0 / 15%),
          0 0.0625rem 0.125rem 0 rgb(0 0 0 / 30%);
        transition: box-shadow ease-out 150ms;
        transform: rotate(45deg);
        @at-root #{$selector}:hover::before {
          box-shadow: 0 0.25rem 0.5rem 0.1875rem rgb(0 0 0 / 15%),
            0 0.0625rem 0.1875rem 0 rgb(0 0 0 / 30%);
        }
        @at-root #{$selector}.pressed::before {
          box-shadow: 0 0 0 0 rgb(0 0 0 / 15%), 0 0 0 0 rgb(0 0 0 / 30%);
        }
      }
    }
  }

  &__xy {
    grid-row: 1;
    grid-column: 2;
    border: $border-thickness solid $border-color;

    @include canvas;
    @include area {
      inset: -0.5 * $thumb-size;
    }
    @include thumb {
      top: calc(var(--slider-y) * 0.0625rem);
      left: calc(var(--slider-x) * 0.0625rem);
    }
  }

  &__z {
    $gradient-steps: ();
    @for $cnt from 0 through $gradient-resolution {
      $h: $cnt * math.div(360, $gradient-resolution);
      $gradient-steps: list.join(
        $gradient-steps,
        oklch(70% 0.15 #{$h}deg),
        $separator: comma
      );
    }

    grid-row: 1;
    grid-column: 1;
    background-image: linear-gradient(to bottom, $gradient-steps);
    border: $border-thickness solid $border-color;

    @include canvas;
    @include area {
      top: -0.5 * $thumb-size;
      bottom: -0.5 * $thumb-size;
      left: -0.5 * $thumb-size;
      width: $thumb-size;
    }

    @include thumb {
      &-from {
        top: calc(var(--slider-z-from) * 0.0625rem);
        left: 0;

        &::before {
          $unitless-h: math.div($canvas-height, 1rem) * 16;

          background-color: oklch(
            70% 0.15 calc(var(--slider-z-from) / $unitless-h * 360deg)
          );
        }
      }

      &-to {
        top: calc(var(--slider-z-to) * 0.0625rem);
        left: 0;

        &::before {
          $unitless-h: math.div($canvas-height, 1rem) * 16;

          background-color: oklch(
            70% 0.15 calc(var(--slider-z-to) / $unitless-h * 360deg)
          );
        }
      }
    }
  }

  &__numbers {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-row: 2;
    grid-column: 1 / -1;
    gap: $gap;
  }
}
